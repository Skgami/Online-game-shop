        <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Auto Recharge | Premium Panel</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oxanium:wght@400;700;800&family=Poppins:wght@300;400;600&display=swap');

        :root {
            --primary: #f43f5e;
            --dark: #0f172a;
            --success: #22c55e;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: #f1f5f9; color: var(--dark); padding-bottom: 80px; }

        /* --- Header --- */
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%);
            color: white; padding: 40px 20px; text-align: center;
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
        }
        .header h1 { font-family: 'Oxanium'; font-size: 26px; }

        .balance-box {
            background: white; margin: -20px 25px 25px; padding: 20px;
            border-radius: 20px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .balance-amount { font-family: 'Oxanium'; font-size: 22px; font-weight: 800; color: var(--primary); }

        /* --- Payment Selection --- */
        .method-container { padding: 0 25px; margin-bottom: 25px; }
        .method-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .method-card {
            background: white; padding: 15px 5px; border-radius: 15px; text-align: center;
            cursor: pointer; border: 2px solid transparent; transition: 0.3s;
        }
        .method-card.active { border-color: var(--primary); transform: scale(1.05); }
        .method-card img { width: 45px; height: 45px; margin-bottom: 5px; border-radius: 10px; }

        /* --- Input Box --- */
        .payment-form { margin: 0 25px; background: white; padding: 25px; border-radius: 20px; display: none; animation: slideUp 0.5s ease; }
        .payment-form.active { display: block; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 12px; font-weight: 700; margin-bottom: 5px; color: #64748b; }
        input {
            width: 100%; padding: 12px 15px; border: 1px solid #e2e8f0;
            border-radius: 12px; font-size: 15px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); }

        .btn-verify {
            width: 100%; background: var(--dark); color: white; border: none;
            padding: 15px; border-radius: 12px; font-weight: 800; font-family: 'Oxanium';
            cursor: pointer; transition: 0.3s;
        }
        .btn-verify:hover { background: var(--primary); }

        .status-msg { font-size: 12px; text-align: center; margin-top: 15px; padding: 10px; border-radius: 8px; display: none; }

        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 70px; background: white;
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #ddd;
        }
        .nav-item { text-decoration: none; color: #94a3b8; text-align: center; font-size: 11px; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

    <div class="header">
        <h1>AUTO ADD MONEY</h1>
        <p>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</p>
    </div>

    <div class="balance-box">
        <div><p style="font-size: 12px; color: #64748b;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p></div>
        <div class="balance-amount">‡ß≥ <span id="user-balance">0.00</span></div>
    </div>

    <div class="method-container">
        <h3>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <div class="method-grid">
            <div class="method-card" onclick="selectMethod('bkash', '017XXXXXXXX')">
                <img src="https://i.ibb.co/S6mFvY6/bkash.png">
                <p style="font-size: 11px; font-weight: 700;">bKash</p>
            </div>
            <div class="method-card" onclick="selectMethod('nagad', '018XXXXXXXX')">
                <img src="https://i.ibb.co/By9Xz1N/nagad.png">
                <p style="font-size: 11px; font-weight: 700;">Nagad</p>
            </div>
            <div class="method-card" onclick="selectMethod('rocket', '019XXXXXXXX')">
                <img src="https://i.ibb.co/p33mS85/rocket.png">
                <p style="font-size: 11px; font-weight: 700;">Rocket</p>
            </div>
        </div>
    </div>

    <div class="payment-form" id="pay-box">
        <div style="background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--primary);">
            <p style="font-size: 11px; color: #64748b;">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßã‡¶®‡¶æ‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞:</p>
            <h2 id="admin-num" style="font-family: 'Oxanium'; letter-spacing: 1px;">01XXXXXXXXX</h2>
            <p style="font-size: 10px; color: var(--primary); margin-top: 5px;">* Send Money ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ TrxID ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡¶ø‡¶®‡•§</p>
        </div>

        <div class="input-group">
            <label>‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (Amount)</label>
            <input type="number" id="pay-amount" placeholder="Min 100 TK">
        </div>

        <div class="input-group">
            <label>‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø (Transaction ID)</label>
            <input type="text" id="pay-trxid" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: BKC53H82LS">
        </div>

        <button class="btn-verify" id="submit-btn" onclick="verifyAutoPayment()">VERIFY & ADD MONEY</button>
        
        <div id="status-display" class="status-msg"></div>
    </div>

    <div class="bottom-nav">
        <a href="index.html" class="nav-item">üè†<br>Home</a>
        <a href="shop.html" class="nav-item">üõí<br>Shop</a>
        <a href="add-money.html" class="nav-item active">üí≥<br>Add Money</a>
    </div>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBx8h5PYxI34ZTaHs9ScdA8puSBt6h8yYU",
            authDomain: "panelshop-71ed8.firebaseapp.com",
            projectId: "panelshop-71ed8",
            storageBucket: "panelshop-71ed8.firebasestorage.app",
            messagingSenderId: "741029675696",
            appId: "1:741029675696:web:86331dc6ab82551d86f175"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let currentUid = "";

        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ö‡ßá‡¶ï ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶≤‡ßã‡¶°
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUid = user.uid;
                db.collection("users").doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) document.getElementById('user-balance').innerText = doc.data().balance || 0;
                });
            } else {
                window.location.href = 'login.html';
            }
        });

        function selectMethod(name, num) {
            document.querySelectorAll('.method-card').forEach(c => c.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById('pay-box').classList.add('active');
            document.getElementById('admin-num').innerText = num;
            window.selectedMethod = name;
        }

        // --- ‡¶Æ‡ßÇ‡¶≤ ‡¶Ö‡¶ü‡ßã-‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
        async function verifyAutoPayment() {
            const amount = parseFloat(document.getElementById('pay-amount').value);
            const trxid = document.getElementById('pay-trxid').value.trim();
            const statusBox = document.getElementById('status-display');
            const btn = document.getElementById('submit-btn');

            if (!amount || amount < 100 || !trxid) {
                alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶¶‡¶ø‡¶®‡•§");
                return;
            }

            btn.innerText = "Checking Transaction...";
            btn.disabled = true;

            try {
                // ‡ßß. ‡¶è‡¶∏‡¶è‡¶Æ‡¶è‡¶∏ ‡¶≤‡¶ó ‡¶•‡ßá‡¶ï‡ßá ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá
                const smsRef = db.collection("sms_logs").doc(trxid);
                const doc = await smsRef.get();

                if (doc.exists) {
                    const smsData = doc.data();

                    // ‡ß®. ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶ö‡ßá‡¶ï
                    if (smsData.isUsed) {
                        showStatus("‡¶è‡¶á ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ü‡¶ó‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "red");
                    } 
                    // ‡ß©. ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ö‡ßá‡¶ï (Amount Match)
                    else if (smsData.amount < amount) {
                        showStatus("‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶≤‡ßá‡¶®‡¶ø! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü: ‡ß≥" + smsData.amount, "orange");
                    } 
                    // ‡ß™. ‡¶∏‡¶¨‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶π‡¶≤‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°
                    else {
                        await db.collection("users").doc(currentUid).update({
                            balance: firebase.firestore.FieldValue.increment(smsData.amount)
                        });
                        
                        // ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü‡¶¨‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶π‡ßü
                        await smsRef.update({ isUsed: true, usedBy: currentUid });

                        showStatus("‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡ß≥" + smsData.amount + " ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§", "green");
                        alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                    }
                } else {
                    // ‡ß´. ‡¶Ø‡¶¶‡¶ø ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶≠‡ßÅ‡ßü‡¶æ ‡¶π‡ßü (Rejected)
                    showStatus("‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø! ‡¶∏‡¶†‡¶ø‡¶ï TrxID ‡¶¶‡¶ø‡¶®‡•§", "red");
                }
            } catch (err) {
                showStatus("‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶è‡¶∞‡¶∞: " + err.message, "red");
            } finally {
                btn.innerText = "VERIFY & ADD MONEY";
                btn.disabled = false;
            }
        }

        function showStatus(msg, color) {
            const box = document.getElementById('status-display');
            box.innerText = msg;
            box.style.display = 'block';
            box.style.background = color === 'green' ? '#dcfce7' : (color === 'red' ? '#fee2e2' : '#fef3c7');
            box.style.color = color === 'green' ? '#166534' : (color === 'red' ? '#991b1b' : '#92400e');
        }
    </script>
</body>
</html>
