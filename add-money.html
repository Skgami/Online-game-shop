<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Secure Funds Gateway | প্রিমিয়াম রিচার্জ পোর্টাল</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Hind+Siliguri:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* ========================================================
           ULTIMATE CSS ARCHITECTURE (250+ LINES)
           ========================================================
        */
        :root {
            /* Core Color Palette */
            --primary-core: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.4);
            --bkash-main: #d12053;
            --nagad-main: #f37021;
            
            /* Surface & Glassmorphism Colors */
            --surface-deep: #020617;
            --card-glass: rgba(15, 23, 42, 0.85);
            --border-highlight: rgba(255, 255, 255, 0.08);
            --input-bg: rgba(15, 23, 42, 0.6);
            
            /* Typography Colors */
            --text-pure: #ffffff;
            --text-vibrant: #f8fafc;
            --text-muted: #94a3b8;
            --text-success: #10b981;
            --text-error: #ef4444;
            
            /* Transitions & Effects */
            --transition-smooth: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --shadow-standard: 0 40px 100px -20px rgba(0, 0, 0, 0.6);
            --font-display: 'Outfit', 'Hind Siliguri', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* --- Global Reset & Scroll Behavior --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--surface-deep);
            font-family: var(--font-display);
            color: var(--text-vibrant);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            background: 
                radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.18) 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(168, 85, 247, 0.18) 0%, transparent 40%),
                linear-gradient(135deg, #020617 0%, #0f172a 100%);
        }

        /* --- Dynamic Animated Background Particles --- */
        .portal-bg-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: 
                radial-gradient(var(--border-highlight) 1.5px, transparent 1.5px);
            background-size: 40px 40px;
            opacity: 0.2;
            z-index: -1;
            pointer-events: none;
        }

        /* --- Main Gateway Framework --- */
        .gateway-master-container {
            width: 100%;
            max-width: 580px;
            padding: 25px;
            perspective: 2000px;
        }

        .gateway-portal-card {
            background: var(--card-glass);
            backdrop-filter: blur(40px) saturate(200%);
            -webkit-backdrop-filter: blur(40px) saturate(200%);
            border: 1px solid var(--border-highlight);
            border-radius: 45px;
            padding: 55px 45px;
            box-shadow: var(--shadow-standard);
            position: relative;
            transform-style: preserve-3d;
            animation: gatewayEntrance 1.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes gatewayEntrance {
            from { opacity: 0; transform: translateY(60px) scale(0.9) rotateX(-15deg); }
            to { opacity: 1; transform: translateY(0) scale(1) rotateX(0deg); }
        }

        /* --- Header & Navigation Interface --- */
        .portal-header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 45px;
        }

        .back-home-trigger {
            text-decoration: none;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 22px;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 18px;
            border: 1px solid transparent;
            transition: var(--transition-smooth);
        }

        .back-home-trigger:hover {
            color: var(--text-pure);
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(-8px);
            border-color: var(--border-highlight);
        }

        .encrypted-badge {
            background: rgba(16, 185, 129, 0.1);
            color: var(--text-success);
            padding: 10px 18px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* --- Identity & Branding --- */
        .identity-stack {
            text-align: center;
            margin-bottom: 40px;
        }

        .identity-stack h1 {
            font-size: 34px;
            font-weight: 800;
            letter-spacing: -1.5px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #ffffff 0%, #94a3b8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .identity-stack p {
            color: var(--text-muted);
            font-size: 15px;
            font-weight: 500;
            line-height: 1.6;
        }

        /* --- Centralized Payment Display --- */
        .payment-info-nexus {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-highlight);
            border-radius: 32px;
            padding: 35px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: var(--transition-smooth);
        }

        .payment-info-nexus:hover {
            border-color: var(--primary-core);
            background: rgba(0, 0, 0, 0.5);
        }

        .nexus-label-mix {
            font-size: 12px;
            font-weight: 800;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 3px;
            display: block;
            margin-bottom: 15px;
        }

        .nexus-target-number {
            font-family: var(--font-mono);
            font-size: 36px;
            font-weight: 700;
            color: var(--text-pure);
            letter-spacing: 3px;
            text-shadow: 0 0 25px var(--primary-glow);
            margin-bottom: 20px;
            display: block;
        }

        .provider-cluster {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .provider-pill {
            font-size: 12px;
            font-weight: 800;
            padding: 8px 18px;
            border-radius: 12px;
            text-transform: uppercase;
            transition: var(--transition-smooth);
        }

        .pill-bkash { background: rgba(209, 32, 83, 0.1); color: var(--bkash-main); border: 1px solid rgba(209, 32, 83, 0.2); }
        .pill-nagad { background: rgba(243, 112, 33, 0.1); color: var(--nagad-main); border: 1px solid rgba(243, 112, 33, 0.2); }

        /* --- Form Engineering & Input Logic --- */
        .gateway-form-engine {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }

        .input-block {
            position: relative;
        }

        .block-label-bilingual {
            display: block;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-muted);
            margin-bottom: 12px;
            padding-left: 8px;
            transition: var(--transition-smooth);
        }

        .input-visual-container {
            position: relative;
            width: 100%;
        }

        .input-visual-container i {
            position: absolute;
            left: 22px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-core);
            font-size: 20px;
            transition: var(--transition-smooth);
            z-index: 5;
        }

        .gateway-input-field {
            width: 100%;
            background: var(--input-bg);
            border: 2px solid var(--border-highlight);
            border-radius: 22px;
            padding: 22px 22px 22px 62px;
            color: var(--text-pure);
            font-family: var(--font-display);
            font-size: 17px;
            font-weight: 600;
            transition: var(--transition-smooth);
            position: relative;
        }

        .gateway-input-field:focus {
            border-color: var(--primary-core);
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.25);
            transform: translateY(-3px);
        }

        .gateway-input-field:focus + i {
            color: var(--text-pure);
            text-shadow: 0 0 10px var(--primary-core);
        }

        .field-helper-bn {
            font-size: 11.5px;
            color: #64748b;
            margin-top: 10px;
            margin-left: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* --- Primary Verification Engine Button --- */
        .verification-master-btn {
            width: 100%;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-core) 0%, #4f46e5 100%);
            color: var(--text-pure);
            border: none;
            border-radius: 24px;
            font-family: var(--font-display);
            font-size: 18px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: var(--transition-smooth);
            box-shadow: 0 20px 50px -10px var(--primary-glow);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 18px;
            margin-top: 10px;
        }

        .verification-master-btn:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 35px 70px -10px var(--primary-glow);
            filter: brightness(1.15);
        }

        .verification-master-btn:active {
            transform: translateY(2px);
        }

        .verification-master-btn:disabled {
            background: #1e293b;
            color: #475569;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        /* --- Smart Feedback Messaging System --- */
        .smart-status-banner {
            margin-top: 35px;
            border-radius: 20px;
            padding: 20px;
            font-size: 15px;
            font-weight: 700;
            text-align: center;
            display: none;
            animation: bannerSlideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            line-height: 1.5;
        }

        @keyframes bannerSlideIn {
            from { opacity: 0; transform: translateY(30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* --- High-Performance Loader Animation --- */
        .portal-loader-ring {
            width: 26px; height: 26px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid var(--text-pure);
            border-radius: 50%;
            animation: ringSpin 0.7s linear infinite;
        }

        @keyframes ringSpin {
            100% { transform: rotate(360deg); }
        }

        /* --- Global Trust Array --- */
        .global-trust-footer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-top: 50px;
            opacity: 0.35;
        }

        .global-trust-footer i {
            font-size: 28px;
            transition: var(--transition-smooth);
        }

        .global-trust-footer i:hover {
            opacity: 1;
            color: var(--primary-core);
            transform: scale(1.25);
        }

        /* --- Keyframe Library for Javascript Effects --- */
        @keyframes fieldShake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        /* Responsive Optimization */
        @media (max-width: 480px) {
            .gateway-portal-card { padding: 40px 25px; border-radius: 35px; }
            .nexus-target-number { font-size: 28px; }
            .verification-master-btn { font-size: 16px; padding: 22px; }
        }
    </style>
</head>
<body>

    <div class="portal-bg-overlay"></div>

    <div class="gateway-master-container">
        <div class="gateway-portal-card" id="mainPortal">
            
            <nav class="portal-header-nav">
                <a href="index.html" class="back-home-trigger">
                    <i class="fas fa-arrow-left-long"></i>
                    <span>HOME (হোম)</span>
                </a>
                <div class="encrypted-badge">
                    <i class="fas fa-shield-check"></i>
                    <span>AES-256 SECURE</span>
                </div>
            </nav>

            <section class="identity-stack">
                <h1>Deposit Center</h1>
                <p>বিকাশ বা নগদ থেকে রিচার্জ করতে নিচের তথ্যগুলো নির্ভুলভাবে প্রদান করুন</p>
            </section>

            <section class="payment-info-nexus">
                <span class="nexus-label-mix">Receiver Mobile (পার্সোনাল নম্বর)</span>
                <span class="nexus-target-number">01992170327</span>
                <div class="provider-cluster">
                    <span class="provider-pill pill-bkash">bKash Personal</span>
                    <span class="provider-pill pill-nagad">Nagad Personal</span>
                </div>
            </section>

            <div class="gateway-form-engine">
                
                <div class="input-block">
                    <label class="block-label-bilingual">Transaction Amount / টাকার পরিমাণ (Min: 100)</label>
                    <div class="input-visual-container">
                        <i class="fas fa-money-bill-wave"></i>
                        <input type="number" id="gateAmount" class="gateway-input-field" placeholder="কত টাকা পাঠিয়েছেন? (যেমন: ৫০০)">
                    </div>
                    <p class="field-helper-bn"><i class="fas fa-info-circle"></i> ১০০ টাকা থেকে শুরু করে ২৫,০০০ টাকা পর্যন্ত রিচার্জ করা যাবে।</p>
                </div>

                <div class="input-block">
                    <label class="block-label-bilingual">Sender Mobile / আপনার মোবাইল নম্বর</label>
                    <div class="input-visual-container">
                        <i class="fas fa-phone-square-alt"></i>
                        <input type="tel" id="gateSender" class="gateway-input-field" placeholder="আপনার বিকাশ/নগদ নম্বরটি লিখুন" maxlength="11">
                    </div>
                    <p class="field-helper-bn"><i class="fas fa-user-check"></i> যে নম্বর থেকে টাকা পাঠিয়েছেন সেই নম্বরটি এখানে দিন।</p>
                </div>

                <div class="input-block">
                    <label class="block-label-bilingual">Transaction ID / ট্রানজেকশন আইডি (TrxID)</label>
                    <div class="input-visual-container">
                        <i class="fas fa-receipt"></i>
                        <input type="text" id="gateTrx" class="gateway-input-field" placeholder="SMS থেকে TrxID কপি করে এখানে দিন" autocomplete="off" spellcheck="false">
                    </div>
                    <p class="field-helper-bn"><i class="fas fa-key"></i> ট্রানজেকশন সফল হওয়ার পর পাওয়া আইডিটি সঠিকভাবে লিখুন।</p>
                </div>

                <button class="verification-master-btn" id="gateSubmitBtn" onclick="initiateGatewayVerification()">
                    <span id="btnLabelStandard">VERIFY NOW (ভেরিফাই করুন)</span>
                    <i class="fas fa-bolt-lightning" id="btnIconStandard"></i>
                </button>

                <div id="portalStatusBanner" class="smart-status-banner"></div>

            </div>

            <footer class="global-trust-footer">
                <i class="fab fa-cc-visa" title="Verified by Visa"></i>
                <i class="fab fa-cc-mastercard" title="Mastercard Identity Check"></i>
                <i class="fas fa-shield-halved" title="End-to-End Encrypted"></i>
                <i class="fas fa-building-columns" title="Secure Banking Protocol"></i>
            </footer>
        </div>
    </div>

    <script>
        /**
         * GLOBAL CONSTANTS & API CONFIGURATION
         */
        const FIREBASE_SMS_ENDPOINT = "https://panelshop-71ed8-default-rtdb.firebaseio.com/sms_logs.json";

        /**
         * Main Execution Routine for Payment Verification
         */
        async function initiateGatewayVerification() {
            // Local Element Selectors
            const fAmount = document.getElementById('gateAmount');
            const fSender = document.getElementById('gateSender');
            const fTrxID = document.getElementById('gateTrx');
            const fBtn = document.getElementById('gateSubmitBtn');
            const fStatus = document.getElementById('portalStatusBanner');

            // Extraction & Normalization
            const amountValue = parseFloat(fAmount.value);
            const senderPhone = fSender.value.trim();
            const trxToken = fTrxID.value.trim().toUpperCase();

            // 1. MULTI-LEVEL VALIDATION ENGINE
            if (isNaN(amountValue) || amountValue < 100) {
                triggerErrorState("gateAmount", "INVALID AMOUNT! (টাকার পরিমাণ সঠিক নয়)", "কমপক্ষে ১০০ টাকা রিচার্জ করা আবশ্যক।");
                return;
            }

            if (amountValue > 25000) {
                triggerErrorState("gateAmount", "LIMIT EXCEEDED! (সীমা অতিক্রম করেছে)", "একবারে ২৫,০০০ টাকার বেশি রিচার্জ করা সম্ভব নয়।");
                return;
            }

            if (senderPhone.length < 11) {
                triggerErrorState("gateSender", "INVALID PHONE! (নম্বরটি সঠিক নয়)", "১১ ডিজিটের সঠিক মোবাইল নম্বর প্রদান করুন।");
                return;
            }

            if (trxToken.length < 6) {
                triggerErrorState("gateTrx", "INVALID TrxID! (আইডিটি সঠিক নয়)", "সঠিক ট্রানজেকশন আইডিটি SMS থেকে কপি করে দিন।");
                return;
            }

            // 2. ACTIVATING PROCESSING STATE
            setGatewayUIState(true);
            renderStatusMessage("SYNCING WITH NETWORK... (অপেক্ষা করুন)", "neutral");

            try {
                // 3. SECURE DATA FETCH FROM FIREBASE
                const fetchRequest = await fetch(FIREBASE_SMS_ENDPOINT);
                
                if (!fetchRequest.ok) throw new Error("Network latency detected.");

                const smsDatabase = await fetchRequest.json();
                let matchingRecordKey = null;

                // 4. TRANSACTION MATCHING ALGORITHM (O(n) COMPLEXITY)
                for (let recordKey in smsDatabase) {
                    const currentRecord = smsDatabase[recordKey];
                    
                    // Critical Business Logic: Match TrxID and check 'isUsed' flag
                    if (currentRecord.content.toUpperCase().includes(trxToken) && !currentRecord.isUsed) {
                        matchingRecordKey = recordKey;
                        break;
                    }
                }

                if (matchingRecordKey) {
                    // 5. COMMITTING TO REALTIME DATABASE (ATOMIC PATCH)
                    await updateTransactionStatus(matchingRecordKey, amountValue, senderPhone);

                    // 6. SUCCESS VISUAL CELEBRATION
                    triggerConfettiBlast();
                    renderStatusMessage(`SUCCESS! ৳${amountValue} ADDED TO WALLET. (সফল হয়েছে)`, "success");

                    // 7. DELAYED REDIRECTION HANDLER
                    setTimeout(() => {
                        window.location.href = "dashboard.html";
                    }, 3800);

                } else {
                    // 8. FAILED VERIFICATION HANDLING
                    renderStatusMessage("TRANSACTION NOT FOUND! (আইডি পাওয়া যায়নি)", "danger");
                    setGatewayUIState(false);
                }

            } catch (fatalError) {
                // 9. ERROR RECOVERY PROTOCOL
                console.error("Gateway Fatal Error:", fatalError);
                renderStatusMessage("GATEWAY TIMEOUT! (সার্ভার সংযোগ বিচ্ছিন্ন)", "danger");
                setGatewayUIState(false);
            }
        }

        /**
         * Atomic Patch Operation for Firebase
         */
        async function updateTransactionStatus(dbKey, depositAmt, senderPhn) {
            const patchUrl = `https://panelshop-71ed8-default-rtdb.firebaseio.com/sms_logs/${dbKey}.json`;
            const payload = {
                isUsed: true,
                final_amount: depositAmt,
                sender_mobile: senderPhn,
                process_timestamp: new Date().toISOString(),
                security_check: "VERIFIED_V8_ULTIMATE"
            };

            await fetch(patchUrl, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        }

        /**
         * Dynamic UI State Controller
         */
        function setGatewayUIState(isLoading) {
            const btn = document.getElementById('gateSubmitBtn');
            const label = document.getElementById('btnLabelStandard');
            const icon = document.getElementById('btnIconStandard');

            if (isLoading) {
                btn.disabled = true;
                label.innerText = "PROCESSING TRANSACTION...";
                icon.className = "portal-loader-ring";
            } else {
                btn.disabled = false;
                label.innerText = "VERIFY NOW (ভেরিফাই করুন)";
                icon.className = "fas fa-bolt-lightning";
            }
        }

        /**
         * Advanced Feedback Component
         */
        function renderStatusMessage(mainText, stateType) {
            const banner = document.getElementById('portalStatusBanner');
            banner.style.display = "block";
            banner.innerText = mainText;

            // Reset Styles
            banner.style.background = "";
            banner.style.color = "";
            banner.style.border = "";

            if (stateType === "success") {
                banner.style.background = "rgba(16, 185, 129, 0.12)";
                banner.style.color = "var(--text-success)";
                banner.style.border = "1px solid rgba(16, 185, 129, 0.3)";
            } else if (stateType === "danger") {
                banner.style.background = "rgba(239, 68, 68, 0.12)";
                banner.style.color = "var(--text-error)";
                banner.style.border = "1px solid rgba(239, 68, 68, 0.3)";
            } else {
                banner.style.background = "rgba(148, 163, 184, 0.08)";
                banner.style.color = "var(--text-muted)";
                banner.style.border = "1px solid rgba(148, 163, 184, 0.2)";
            }
        }

        /**
         * Error UX Visual Protocol
         */
        function triggerErrorState(fieldId, title, message) {
            const el = document.getElementById(fieldId);
            el.style.borderColor = "var(--text-error)";
            el.style.animation = "fieldShake 0.4s ease";
            
            renderStatusMessage(`${title} - ${message}`, "danger");
            
            setTimeout(() => {
                el.style.animation = "";
                el.style.borderColor = "var(--border-highlight)";
            }, 2000);
        }

        /**
         * Confetti Particle Logic
         */
        function triggerConfettiBlast() {
            const duration = 3 * 1000;
            const end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#6366f1', '#10b981']
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#6366f1', '#10b981']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        // Auto-Focus Logic for UX
        window.onload = () => {
            gsap.from(".input-block", {
                duration: 0.8,
                opacity: 0,
                y: 20,
                stagger: 0.15,
                ease: "power2.out"
            });
            document.getElementById('gateAmount').focus();
        };

    </script>
</body>
</html>
