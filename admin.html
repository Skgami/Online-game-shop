<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶ó‡ßá‡¶Æ‡¶∏</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oxanium:wght@400;700&display=swap');
        body { font-family: 'Oxanium', sans-serif; background: #f0f2f5; padding: 20px; }
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-left: 5px solid #3b82f6; }
        .btn-approve { background: #22c55e; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-right: 5px; }
        .btn-reject { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .info { margin-bottom: 15px; line-height: 1.6; }
        .info b { color: #1e293b; }
        h2 { text-align: center; color: #1e293b; margin-bottom: 25px; }
    </style>
</head>
<body>

    <h2>üõ†Ô∏è Payment Admin Dashboard</h2>
    <div id="request-list">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBx8h5PYxI34ZTaHs9ScdA8puSBt6h8yYU",
            authDomain: "panelshop-71ed8.firebaseapp.com",
            projectId: "panelshop-71ed8",
            storageBucket: "panelshop-71ed8.firebasestorage.app",
            messagingSenderId: "741029675696",
            appId: "1:741029675696:web:86331dc6ab82551d86f175"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ
        db.collection("deposit_requests").where("status", "==", "Pending").onSnapshot(snapshot => {
            const list = document.getElementById("request-list");
            list.innerHTML = "";
            
            if (snapshot.empty) {
                list.innerHTML = "<p style='text-align:center; color: gray;'>‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</p>";
                return;
            }

            snapshot.forEach(doc => {
                const req = doc.data();
                const id = doc.id;
                list.innerHTML += `
                    <div class="card">
                        <div class="info">
                            <b>‡¶Æ‡ßá‡¶•‡¶°:</b> ${req.method} <br>
                            <b>‡¶ü‡¶æ‡¶ï‡¶æ:</b> ‡ß≥${req.amount} <br>
                            <b>‡¶∏‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞:</b> ${req.senderNumber} <br>
                            <b>TrxID:</b> <span style="color: blue;">${req.transactionID}</span> <br>
                            <b>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø:</b> ${req.uid}
                        </div>
                        <button class="btn-approve" onclick="approve('${id}', '${req.uid}', ${req.amount})">APPROVE (‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°)</button>
                        <button class="btn-reject" onclick="reject('${id}')">REJECT</button>
                    </div>
                `;
            });
        });

        async function approve(docId, uid, amount) {
            if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®? ‡¶è‡¶ü‡¶ø ‡¶ï‡¶∞‡¶≤‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§")) {
                const userRef = db.collection("users").doc(uid);
                const userDoc = await userRef.get();
                
                if (userDoc.exists) {
                    const currentBalance = userDoc.data().balance || 0;
                    await userRef.update({ balance: currentBalance + amount });
                    await db.collection("deposit_requests").doc(docId).update({ status: "Success" });
                    alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                } else {
                    alert("‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
                }
            }
        }

        async function reject(docId) {
            if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶è‡¶á ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) {
                await db.collection("deposit_requests").doc(docId).update({ status: "Rejected" });
            }
        }
    </script>
</body>
</html>